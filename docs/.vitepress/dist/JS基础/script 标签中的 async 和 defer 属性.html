<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>script 标签中的 async 和 defer 属性 | Hello VitePress</title>
    <meta name="description" content="Just playing around.">
    <link rel="stylesheet" href="/assets/style.6a954ebc.css">
    <link rel="modulepreload" href="/assets/Home.526846bb.js">
    <link rel="modulepreload" href="/assets/app.bb0c571a.js">
    <link rel="modulepreload" href="/assets/JS基础_script 标签中的 async 和 defer 属性.md.a63b9c51.lean.js">
    <link rel="modulepreload" href="/assets/app.bb0c571a.js">
    <meta name="twitter:title" content="script 标签中的 async 和 defer 属性 | Hello VitePress">
    <meta property="og:title" content="script 标签中的 async 和 defer 属性 | Hello VitePress">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Hello VitePress, back to home" data-v-675d8756 data-v-4a583abe><!----> Hello VitePress</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><!----></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><!----><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#script">script</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#async-script">async script</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#defer-script">defer script</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="script-标签中的-async-和-defer-属性" tabindex="-1">script 标签中的 async 和 defer 属性 <a class="header-anchor" href="#script-标签中的-async-和-defer-属性" aria-hidden="true">#</a></h1><p>在 HTML 中会遇到以下三类 script：</p><ul><li><code>&lt;script src=&#39;xxx&#39;&gt;&lt;/script&gt;</code></li><li><code>&lt;script src=&#39;xxx&#39; async&gt;&lt;/script&gt;</code></li><li><code>&lt;script src=&#39;xxx&#39; defer&gt;&lt;/script&gt;</code></li></ul><p>那么这三类 script 有什么区别呢？</p><h2 id="script" tabindex="-1">script <a class="header-anchor" href="#script" aria-hidden="true">#</a></h2><p>浏览器在解析 HTML 的时候，如果遇到一个没有任何属性的 script 标签，就会暂停解析，先发送网络请求获取该 JS 脚本的代码内容，然后让 JS 引擎执行该代码，当代码执行完毕后恢复解析。整个过程如下图所示： <img src="https://cdn.nlark.com/yuque/0/2021/webp/12821255/1628234078236-8890bd6b-b640-4b4d-b90d-92e1f34bbd37.webp#align=left&amp;display=inline&amp;height=99&amp;margin=%5Bobject%20Object%5D&amp;originHeight=99&amp;originWidth=652&amp;size=0&amp;status=done&amp;style=none&amp;width=652" alt=""> 可以看到，script 阻塞了浏览器对 HTML 的解析，如果获取 JS 脚本的网络请求迟迟得不到响应，或者 JS 脚本执行时间过长，都会导致白屏，用户看不到页面内容。</p><h2 id="async-script" tabindex="-1">async script <a class="header-anchor" href="#async-script" aria-hidden="true">#</a></h2><p>async 表示异步，例如七牛的源码中就有大量的 async 出现： <img src="https://cdn.nlark.com/yuque/0/2021/webp/12821255/1628234078229-2e79e914-858c-4715-b1ba-013846997687.webp#align=left&amp;display=inline&amp;height=134&amp;margin=%5Bobject%20Object%5D&amp;originHeight=134&amp;originWidth=652&amp;size=0&amp;status=done&amp;style=none&amp;width=652" alt="">当浏览器遇到带有 async 属性的 script 时，请求该脚本的网络请求是异步的，不会阻塞浏览器解析 HTML，一旦网络请求回来之后，如果此时 HTML 还没有解析完，浏览器会暂停解析，先让 JS 引擎执行代码，执行完毕后再进行解析，图示如下： <img src="https://cdn.nlark.com/yuque/0/2021/webp/12821255/1628234078243-21d537f5-0e76-4182-8dbe-1d054c95aa16.webp#align=left&amp;display=inline&amp;height=99&amp;margin=%5Bobject%20Object%5D&amp;originHeight=99&amp;originWidth=652&amp;size=0&amp;status=done&amp;style=none&amp;width=652" alt=""> 当然，如果在 JS 脚本请求回来之前，HTML 已经解析完毕了，那就啥事没有，立即执行 JS 代码，如下图所示： <img src="https://cdn.nlark.com/yuque/0/2021/webp/12821255/1628234078373-af12ab27-c731-44b3-bc66-871f16da1a3f.webp#align=left&amp;display=inline&amp;height=99&amp;margin=%5Bobject%20Object%5D&amp;originHeight=99&amp;originWidth=652&amp;size=0&amp;status=done&amp;style=none&amp;width=652" alt=""> 所以 async 是不可控的，因为执行时间不确定，你如果在异步 JS 脚本中获取某个 DOM 元素，有可能获取到也有可能获取不到。而且如果存在多个 async 的时候，它们之间的执行顺序也不确定，完全依赖于网络传输结果，谁先到执行谁。</p><h2 id="defer-script" tabindex="-1">defer script <a class="header-anchor" href="#defer-script" aria-hidden="true">#</a></h2><p>defer 表示延迟，例如掘金的源码中就有大量的 defer 出现： <img src="https://cdn.nlark.com/yuque/0/2021/webp/12821255/1628234078242-0356940b-23d4-45fa-bb87-dd8eaab09473.webp#align=left&amp;display=inline&amp;height=113&amp;margin=%5Bobject%20Object%5D&amp;originHeight=113&amp;originWidth=652&amp;size=0&amp;status=done&amp;style=none&amp;width=652" alt=""> 当浏览器遇到带有 defer 属性的 script 时，获取该脚本的网络请求也是异步的，不会阻塞浏览器解析 HTML，一旦网络请求回来之后，如果此时 HTML 还没有解析完，浏览器不会暂停解析并执行 JS 代码，而是等待 HTML 解析完毕再执行 JS 代码，图示如下： <img src="https://cdn.nlark.com/yuque/0/2021/webp/12821255/1628234078242-29cb9f2a-5144-468d-b06b-491e067068a9.webp#align=left&amp;display=inline&amp;height=99&amp;margin=%5Bobject%20Object%5D&amp;originHeight=99&amp;originWidth=652&amp;size=0&amp;status=done&amp;style=none&amp;width=652" alt=""> 如果存在多个 defer script 标签，浏览器（IE9及以下除外）会保证它们按照在 HTML 中出现的顺序执行，不会破坏 JS 脚本之间的依赖关系。 最后，根据上面的分析，不同类型 script 的执行顺序及其是否阻塞解析 HTML 总结如下：</p><table><thead><tr><th>script 标签</th><th>JS 执行顺序</th><th>是否阻塞解析 HTML</th></tr></thead><tbody><tr><td><code>&lt;script&gt;</code></td><td>在 HTML 中的顺序</td><td>阻塞</td></tr><tr><td><code>&lt;script async&gt;</code></td><td>网络请求返回顺序</td><td>可能阻塞，也可能不阻塞</td></tr><tr><td><code>&lt;script defer&gt;</code></td><td>在 HTML 中的顺序</td><td>不阻塞</td></tr></tbody></table><p>原文：<a href="https://juejin.cn/post/6894629999215640583" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6894629999215640583</a></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"6e5de18f\",\"readme.md\":\"ad69e0ca\",\"css_link和@import.md\":\"3cdea20f\",\"http_http报文格式.md\":\"8667d1e5\",\"http_http版本.md\":\"093534b0\",\"http_http状态码.md\":\"55011d2f\",\"js基础_promise面试题.md\":\"f3cb6123\",\"js基础_script 标签中的 async 和 defer 属性.md\":\"a63b9c51\",\"tcp_tcp三次握手四次挥手.md\":\"3d569a78\",\"tcp_tcp报文格式.md\":\"1dfff0e2\",\"tcp_tcp重传、流量控制与拥塞控制.md\":\"6f310547\",\"vue2_vuex.md\":\"69da11eb\",\"前后端通信_ajax.md\":\"ae41f508\",\"前后端通信_跨域.md\":\"b8bf4898\",\"手写_封装ajax.md\":\"7e7e5bbe\",\"手写_深浅拷贝.md\":\"5e329070\",\"浏览器_从输入url到显示发生了什么.md\":\"7b1a9723\",\"浏览器_浏览器内核的理解.md\":\"5c4cba98\",\"算法_十大经典排序算法.md\":\"2b5b1841\"}")</script>
    <script type="module" async src="/assets/app.bb0c571a.js"></script>
  </body>
</html>